# 网络层

## 功能

主要任务是把分组从源端传送到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是数据报。

1. 路由选择与分组转发
2. 异构网络互联
3. 拥塞控制：若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞。

## IPv4

### 分类的IP地址

IP地址：全世界唯一的4字节标识符，标识路由器主机接口

IP地址 = {<网络号>, <主机号>}

A类：1~126，8位网络号

B类：128~191，16位网络号

C类：192~223，24位网络号

D类：224~239，多播地址

E类：240~255，保留为今后使用

## 特殊IP地址

| NetID网络号 | HostID主机号         | 作为IP分组源地址 | 作为IP分组目的地址 | 用途                                                         |
| ----------- | -------------------- | ---------------- | ------------------ | ------------------------------------------------------------ |
| 全0         | 全0                  | 可以             | 不可以             | 本网范围内表示主机，路由表中表示默认路由（表示整个Internet网络） |
| 全0         | 特定值               | 可以             | 不可以             | 表示本网内某个特定主机                                       |
| 全1         | 全1                  | 不可以           | 可以               | 本网广播地址（路由器不转发）                                 |
| 特定值      | 全0                  | 不可以           | 不可以             | 网络地址，表示一个网络                                       |
| 特定值      | 全1                  | 不可以           | 可以               | 直接广播地址，对特定网络上的所有主机进行广播                 |
| 127         | 任何数（非全0或全1） | 可以             | 可以               | 用于本地软件环回测试，称为环回地址                           |

## 私有IP地址

| 地址类型 | 地址范围                    | 网段个数 |
| -------- | --------------------------- | -------- |
| A类      | 10.0.0.0~10.255.255.255     | 1        |
| B类      | 172.16.0.0~172.31.255.255   | 16       |
| C类      | 192.168.0.0~192.168.255.255 | 256      |

## 网络地址转换（NAT）

路由器对目的地址是私有IP地址的数据包一律不进行转发

网络地址转换NAT：在**专用网**连接到**因特网**的路由器上安装NAT软件，安装了NAT软件的路由器叫做**NAT路由器**，他至少有一个有效的**外部全球IP地址**

NAT转换表例子：

| WAN端            | LAN端             |
| ---------------- | ----------------- |
| 172.38.1.5:40001 | 192.168.0.3:30000 |
| 172.38.1.5:40002 | 192.168.0.4:30001 |

## 子网划分和子网掩码

分类的IP地址的弱点：

1. IP地址空间的利用率有时很低
2. 两级IP地址不够灵活

### 子网划分

网络号\|子网号\|主机号

划分子网后。对外仍表现为一个网络，即本单位外的网络看不见不能单位内子网的划分

### 子网掩码

二级IP地址的子网掩码：网络号全1，主机号全0

三级IP地址的子网掩码：网络号与子网号全1，主机号全0

用IP地址与子网掩码逐位与运算，就能得到子网的网络地址

### 使用子网时分组的转发

路由表中：

1. 目的网络的地址
2. 目的网络的子网掩码
3. 下一跳地址

## 无分类编址CIDR

